{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extrastyle %}
{{ block.super }}
<style>
    /* ===== –¢–ï–ú–ù–ê–Ø –¢–ï–ú–ê ===== */
    :root {
        --bg-dark: #1a1a1a;
        --bg-card: #2d2d2d;
        --bg-header: #333333;
        --border-dark: #404040;
        --text-primary: #e0e0e0;
        --text-secondary: #a0a0a0;
        --accent-blue: #4a9eff;
        --accent-green: #4caf50;
        --accent-red: #f44336;
        --accent-orange: #ff9800;
        --accent-purple: #9c27b0;
    }

    body {
        background-color: var(--bg-dark);
    }

    .quick-add-container {
        max-width: 900px;
        margin: 20px auto;
    }
    
    .step-section {
        background: var(--bg-card);
        border: 1px solid var(--border-dark);
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    }
    
    .step-header {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 20px;
        color: var(--accent-blue);
        border-bottom: 2px solid var(--accent-blue);
        padding-bottom: 10px;
    }
    
    .current-selection {
        background: linear-gradient(135deg, #2c3e50, #1e2a36);
        border-left: 4px solid var(--accent-orange);
        padding: 15px 20px;
        margin-bottom: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .current-selection h2 {
        margin: 0;
        color: white;
        font-size: 20px;
        text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }
    
    .form-row {
        margin-bottom: 15px;
    }
    
    .form-row label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--text-primary);
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .form-row input,
    .form-row select {
        padding: 10px 12px;
        border: 1px solid var(--border-dark);
        border-radius: 6px;
        font-size: 14px;
        background: var(--bg-dark);
        color: var(--text-primary);
        transition: all 0.3s;
    }
    
    .form-row input:focus,
    .form-row select:focus {
        border-color: var(--accent-blue);
        outline: none;
        box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.2);
        background: #2a2a2a;
    }
    
    .form-row input[type="number"],
    .form-row input[type="text"] {
        width: 100%;
        max-width: 300px;
    }
    
    .form-row select {
        width: 100%;
        max-width: 300px;
        cursor: pointer;
    }
    
    select option {
        background: var(--bg-dark);
        color: var(--text-primary);
    }
    
    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        text-decoration: none;
        display: inline-block;
        transition: all 0.3s;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    
    .btn:active {
        transform: translateY(0);
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #4a9eff, #2b6eb0);
        color: white;
    }
    
    .btn-primary:hover {
        background: linear-gradient(135deg, #5aa8ff, #3a7ec0);
    }
    
    .btn-success {
        background: linear-gradient(135deg, #4caf50, #2e7d32);
        color: white;
    }
    
    .btn-success:hover {
        background: linear-gradient(135deg, #5cb860, #3e8e41);
    }
    
    .btn-secondary {
        background: linear-gradient(135deg, #757575, #424242);
        color: white;
    }
    
    .btn-secondary:hover {
        background: linear-gradient(135deg, #858585, #525252);
    }
    
    .btn-danger {
        background: linear-gradient(135deg, #f44336, #c62828);
        color: white;
        padding: 6px 12px;
        font-size: 12px;
    }
    
    .btn-danger:hover {
        background: linear-gradient(135deg, #ff5447, #d83838);
    }
    
    .lessons-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .lessons-table th,
    .lessons-table td {
        padding: 14px 12px;
        text-align: left;
    }
    
    .lessons-table th {
        background: linear-gradient(135deg, #333333, #292929);
        font-weight: 600;
        color: var(--accent-blue);
        text-transform: uppercase;
        font-size: 13px;
        letter-spacing: 0.5px;
        border-bottom: 2px solid var(--accent-blue);
    }
    
    .lessons-table td {
        border-bottom: 1px solid var(--border-dark);
        color: var(--text-primary);
    }
    
    .lessons-table tbody tr:hover {
        background: #3a3a3a;
        transition: background 0.3s;
    }
    
    .lessons-table td.number {
        width: 100px;
        font-weight: bold;
        color: var(--accent-orange);
    }
    
    .lessons-table td.actions {
        width: 100px;
        text-align: center;
    }
    
    .no-lessons {
        padding: 30px;
        text-align: center;
        color: var(--text-secondary);
        font-style: italic;
        background: var(--bg-dark);
        border-radius: 8px;
        border: 1px dashed var(--border-dark);
    }
    
    .form-inline {
        display: flex;
        gap: 20px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .form-inline .form-row {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .action-buttons {
        margin-top: 20px;
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }
    
    .messages {
        margin: 20px 0;
    }
    
    .messages .success,
    .messages .info,
    .messages .warning,
    .messages .error {
        padding: 15px 20px;
        border-radius: 8px;
        margin-bottom: 15px;
        animation: slideIn 0.3s;
    }
    
    @keyframes slideIn {
        from {
            transform: translateY(-20px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
    
    .messages .success {
        background: linear-gradient(135deg, #1b5e20, #2e7d32);
        border-left: 4px solid #81c784;
        color: #e8f5e9;
    }
    
    .messages .info {
        background: linear-gradient(135deg, #0d47a1, #1565c0);
        border-left: 4px solid #64b5f6;
        color: #e3f2fd;
    }
    
    .messages .warning {
        background: linear-gradient(135deg, #bf360c, #e65100);
        border-left: 4px solid #ffb74d;
        color: #fff3e0;
    }
    
    .messages .error {
        background: linear-gradient(135deg, #b71c1c, #c62828);
        border-left: 4px solid #ef5350;
        color: #ffebee;
    }
    
    .breadcrumbs {
        margin-bottom: 25px;
        padding: 12px 20px;
        background: var(--bg-card);
        border-radius: 8px;
        border: 1px solid var(--border-dark);
        color: var(--text-secondary);
    }
    
    .breadcrumbs a {
        color: var(--accent-blue);
        text-decoration: none;
    }
    
    .breadcrumbs a:hover {
        text-decoration: underline;
        color: #6ab0ff;
    }
    
    .error {
        color: var(--accent-red);
        font-size: 12px;
        margin-top: 5px;
        font-weight: normal;
    }
    
    input:-webkit-autofill,
    input:-webkit-autofill:hover,
    input:-webkit-autofill:focus {
        -webkit-text-fill-color: var(--text-primary);
        -webkit-box-shadow: 0 0 0px 1000px #2a2a2a inset;
        transition: background-color 5000s ease-in-out 0s;
    }
    
    ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
    }
    
    ::-webkit-scrollbar-track {
        background: var(--bg-dark);
    }
    
    ::-webkit-scrollbar-thumb {
        background: var(--border-dark);
        border-radius: 5px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: var(--accent-blue);
    }
    
    @media (max-width: 768px) {
        .form-inline {
            flex-direction: column;
            align-items: stretch;
        }
        
        .form-inline .form-row {
            width: 100%;
        }
        
        .btn {
            width: 100%;
            text-align: center;
        }
        
        .action-buttons {
            flex-direction: column;
        }
    }
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">–ì–ª–∞–≤–Ω–∞—è</a>
    &rsaquo; <a href="{% url 'admin:bot_globallesson_changelist' %}">–£—Ä–æ–∫–∏</a>
    &rsaquo; –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
</div>
{% endblock %}

{% block content %}
<div class="quick-add-container">
    
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="{% if message.tags %}{{ message.tags }}{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- –®–ê–ì 1: –í—ã–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ -->
    <div class="step-section">
        <div class="step-header">
            {% if has_selection %}
            üìù –ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä
            {% else %}
            üìù –®–∞–≥ 1: –í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å, –±—É–∫–≤—É –∏ –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏
            {% endif %}
        </div>
        
        <form method="post">
            {% csrf_token %}
            
            <div class="form-inline">
                <div class="form-row">
                    <label for="{{ selection_form.grade.id_for_label }}">{{ selection_form.grade.label }}</label>
                    {{ selection_form.grade }}
                    {% if selection_form.grade.errors %}
                        <div class="error">{{ selection_form.grade.errors }}</div>
                    {% endif %}
                </div>
                
                <div class="form-row">
                    <label for="{{ selection_form.letter.id_for_label }}">{{ selection_form.letter.label }}</label>
                    {{ selection_form.letter }}
                    {% if selection_form.letter.errors %}
                        <div class="error">{{ selection_form.letter.errors }}</div>
                    {% endif %}
                </div>
                
                <div class="form-row">
                    <label for="{{ selection_form.day.id_for_label }}">{{ selection_form.day.label }}</label>
                    {{ selection_form.day }}
                    {% if selection_form.day.errors %}
                        <div class="error">{{ selection_form.day.errors }}</div>
                    {% endif %}
                </div>
                
                <div class="form-row">
                    <button type="submit" name="select_schedule" class="btn btn-primary">
                        {% if has_selection %}–ò–∑–º–µ–Ω–∏—Ç—å{% else %}–í—ã–±—Ä–∞—Ç—å{% endif %}
                    </button>
                </div>
            </div>
        </form>
        
        {% if has_selection %}
        <div class="action-buttons">
            <form method="post" style="display: inline;">
                {% csrf_token %}
                <button type="submit" name="reset_selection" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å –≤—ã–±–æ—Ä</button>
            </form>
        </div>
        {% endif %}
    </div>
    
    <!-- –®–ê–ì 2: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–∫–∞–º–∏ -->
    {% if has_selection %}
    <div class="step-section">
        <div class="current-selection">
            <h2>üìö –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: –ö–ª–∞—Å—Å {{ current_grade }}{{ current_letter }}, {{ day_name }}</h2>
        </div>
        
        <div class="step-header">–£—Ä–æ–∫–∏ –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å</div>
        
        {% if lessons %}
        <table class="lessons-table">
            <thead>
                <tr>
                    <th>‚Ññ —É—Ä–æ–∫–∞</th>
                    <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                </tr>
            </thead>
            <tbody>
                {% for lesson in lessons %}
                <tr>
                    <td class="number">{{ lesson.number }}</td>
                    <td>{{ lesson.subject }}</td>
                    <td class="actions">
                        <form method="post" style="display: inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —É—Ä–æ–∫ ‚Ññ{{ lesson.number }} ({{ lesson.subject }})?');">
                            {% csrf_token %}
                            <input type="hidden" name="lesson_id" value="{{ lesson.id }}">
                            <button type="submit" name="delete_lesson" class="btn btn-danger">‚úñÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="no-lessons">
            –£—Ä–æ–∫–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫ –Ω–∏–∂–µ.
        </div>
        {% endif %}
        
        <div class="step-header" style="margin-top: 30px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —É—Ä–æ–∫</div>
        
        <form method="post">
            {% csrf_token %}
            
            <div class="form-inline">
                <div class="form-row">
                    <label for="{{ add_form.number.id_for_label }}">{{ add_form.number.label }}</label>
                    {{ add_form.number }}
                    {% if add_form.number.errors %}
                        <div class="error">{{ add_form.number.errors }}</div>
                    {% endif %}
                </div>
                
                <div class="form-row">
                    <label for="{{ add_form.subject.id_for_label }}">{{ add_form.subject.label }}</label>
                    {{ add_form.subject }}
                    {% if add_form.subject.errors %}
                        <div class="error">{{ add_form.subject.errors }}</div>
                    {% endif %}
                </div>
                
                <div class="form-row">
                    <button type="submit" name="add_lesson" class="btn btn-success">‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫</button>
                </div>
            </div>
        </form>
    </div>
    {% endif %}
    
    <!-- –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ —Å–ø–∏—Å–∫—É -->
    <div class="action-buttons">
        <a href="{% url 'admin:bot_globallesson_changelist' %}" class="btn btn-secondary">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –≤—Å–µ—Ö —É—Ä–æ–∫–æ–≤</a>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        {% if has_selection %}
        var subjectField = document.querySelector('input[name="subject"]');
        if (subjectField) {
            subjectField.focus();
        }
        {% endif %}
    });
</script>
{% endblock %}